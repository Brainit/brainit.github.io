---
date: 2017-04-16 15:43:56+00:00
layout: post
title: 数据库事务管理
categories: Emulate
tags: Emulate MySQL
---

### 目录

1. [事务概念](#step1)
2. [事务特性](#step2)
3. [事务的过程](#step3)
3. [事务自动提交](#step4)
4. [锁](#step5)

---
#### <span id="step1">事务概念</span>
> 构成单一逻辑工作单元的操作集合称作**事务**。
> 
> **事务**是访问并可能更新各种数据项的一个程序执行单元。事务通常由高级数据操纵语言（代表性的是SQL）或编程语言（例如，C++或Java）通过JDBC或ODBC嵌入式数据库访问书写的用户程序的执行所引起的。事务用形如**begin transaction**和**end transaction**语句（或函数调用）来界定，事务由**begin transaction**与**end transaction**之间执行的全部操作组成。


#### <span id="step2">事务特性</span>
> 1. **原子性**：事务是由一个或一组相互关联的SQL语句组成，这些语句被认为是一个不可分割的单元。
2. **一致性**：对于数据库的修改是一致的，即多个用户查的数据是一样的。一致性主要是由MySQL的日志机制处理，他记录数据的变化，为事务回复提供跟踪记录。
3. **隔离性**(独立性)：每个事务都有自己的空间，和其他发生在系统中的事务隔离开来，而且事务的结果只在他完全被执行时才能看到。
4. **持久性**：但提交了这个事务之后对数据的修改更新就是永久的。当一个事务完成，数据库的日志已经被更新时，持久性即可发挥其特有的功效，在MySQL中，如果系统崩溃或者数据存储介质被破坏，通过日志，系统能回复在重启进行的最后一次成功更新，可以反应系统崩溃时处于执行过程的事物的变化。
> 

#### <span id="step3">事务的过程</span>
> 事务的过程：
>> use databases;	#针对某个数据库
>> 
>> begin transaction;	#事务开始
>> 
>> insert into table vaules(1);	#进行数据库操作
>> 
>> commit;		#提高事务
>>
>> rollback;		#如果需要，可以事务回滚

#### <span id="step4">事务自动提交</span>
> 禁止自动提交
>> set autocommit=0;	#设置禁止自动提交
> 
> 开启自动提交
>> set autocommit=1;	#开始自动提交

#### <span id="step5">锁</span>
> 确保隔离性的方法之一就是要求对数据项以互斥的方式进行访问：换句话说，当一个事务访问某个数据项时，其他任何事务都不能修改该数据项。实现该需求最常用的方法是只允许事务访问当前该事务持有锁的数据项。只有当用户释放表的操作锁定后，其他用户才可以访问这些修改的数据。
> 对指定表进行锁操作的过程：
>> 1. 对表进行加锁：
>>> lock table 表名 locktype;	#locktype有read和write两种
>>>
>>> lock table 表名1 locktype1,表名2 locktype2,.... 	#对多表进行加锁操作
>> 2. 对加锁之后的表进行数据操作
>> 3. 对表进行解锁
>>> unlock tables; 	#释放所有加锁的表